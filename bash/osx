#OS-X specific

#aliases
alias ls='ls -F -G'
alias xq='cd /opt/magnolia/Content.xquery/xquery-module/src-xml/xquery'
alias rr='cd ~/Summon/Content.xquery.release-ready/xquery-module/src-xml/xquery/'
alias ltd='cd ~/Summon/local-testdata'
alias cr='cd ~/Summon/content-release'

##Latest commit merged to release-ready with github link
alias lastc='git log -1 --pretty=format:"Merged to release-ready as [%h|https://www.github.com/summon/Content.xquery/commit/%H]" | pbcopy'
##Latest commit on any summon repo with github link
alias gwork='git log -1 --pretty=format:"[%h|https://www.github.com/summon/REPO/commit/%H] -- %s" | sed "s?REPO?$(pwd | cut -d"/" -f4)?" | pbcopy'

##pull latest master from all summmon repos in /opt/magnolia
##FIXME - what if dir is dirty?
alias upall='pushd /opt/magnolia 1> /dev/null; for dir in */; do pushd $dir 1> /dev/null; echo "Updating $dir..." && git pull --ff-only && popd 1> /dev/null; done; popd 1> /dev/null'

##Unload and reload vpn module on OS X
alias unvpn='sudo launchctl unload /System/Library/LaunchDaemons/com.apple.racoon.plist'
alias revpn='sudo launchctl load /System/Library/LaunchDaemons/com.apple.racoon.plist'

##generate a password (OS X specific)
alias pw="export LANG=C;tr -dc 'A-Za-z0-9!@#$%^&*' < /dev/random | fold -w 12 | head -n 1"

#config

#export Magnolia Home for local build
export MAGNOLIA_HOME=/opt/magnolia/Magnolia
export MP=/opt/magnolia/Magnolia/scripts
export JAVA_HOME=/Library/Java/Home
export ASSUMED_ENV=jonah

#wrapper for diffing two files from xquery repo
function gdiff() {
git diff release-ready:xquery-module/src-xml/$1 master:xquery-module/src-xml/$1
}

#format skynet release list output as a jira table, copy to clipboard
function skyform {
awk -F"\t" '{ print "|",$1,"|", $2, "|", $3,"|", $6,"|" }' $1 | sed "1s/|/||/g" | grep -Ev "^[ |]+$" | pbcopy
}

#run ingestion lite more ez-ily
function ezxa {
if [ -z "$1" ]; then
    echo "Usage: ezxa name-of-directory-you-are-processing"
    return 1
fi
pushd /opt/magnolia/Magnolia/scripts > /dev/null &&
/opt/magnolia/Magnolia/scripts/xml-analyzer-v2.sh -p /Users/jbull/Summon/local-testdata/$1/ingestion-lite.properties -o /Users/jbull/Summon/local-testdata/$1/analyzer-out -l $1 &&
popd > /dev/null &&
less +F /opt/magnolia/Magnolia/logs/xml-analyzer-$1.log
}

boilerplate-tmux() {
    tmux start-server
    tmux new-session -d -s summon -n local
    tmux new-window -t summon:2 -n prod
    tmux new-window -t summon:3 -n test
    tmux new-window -t summon:4 -n scratch
    tmux new-window -t summon:5 -n build

    tmux send-keys -t summon:1 "xq; clear" C-m
    tmux split-window -v -p 50 -t summon:1
    tmux send-keys -t summon:1 "cd $MP; clear" C-m
    tmux send-keys -t summon:4 "cr; clear" C-m
    tmux split-window -v -p 50 -t summon:4
    tmux split-window -h -p 50 -t summon:4
    tmux send-keys -t summon:5 "cd /opt/magnolia; clear" C-m

    tmux select-window -t summon:1
    tmux attach-session -t summon
}

